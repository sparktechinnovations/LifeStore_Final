function _0x2b92(){const _0xff72d9=['catch','buffer','Key','production','base64','1119058VeQdbf','env','30taRBUp','4492614ltoxql','https://','AWS_REGION','toString','../middlewares/error/error.handler','.amazonaws.com/','893684ABcDhU','AWS_S3_BUCKET_NAME','send','@aws-sdk/client-s3','ENVIRONMENT','key\x20not\x20provided','334081MxIPES','AWS_S3_REGION','exports','object\x20Deleted','@aws-sdk/s3-request-presigner','3UfLaSz','now','118275apBmoR','AWS_SECRET_ACCESS_KEY','4422348EiIedl','5967104UiDYpv'];_0x2b92=function(){return _0xff72d9;};return _0x2b92();}const _0x4da004=_0x1878;(function(_0x16ea9b,_0x15cb62){const _0xcd0efa=_0x1878,_0x555cb3=_0x16ea9b();while(!![]){try{const _0x5183b6=-parseInt(_0xcd0efa(0x1ed))/0x1+-parseInt(_0xcd0efa(0x1fd))/0x2*(parseInt(_0xcd0efa(0x1f2))/0x3)+-parseInt(_0xcd0efa(0x1e7))/0x4+parseInt(_0xcd0efa(0x1f4))/0x5*(-parseInt(_0xcd0efa(0x1ff))/0x6)+parseInt(_0xcd0efa(0x200))/0x7+parseInt(_0xcd0efa(0x1f7))/0x8+parseInt(_0xcd0efa(0x1f6))/0x9;if(_0x5183b6===_0x15cb62)break;else _0x555cb3['push'](_0x555cb3['shift']());}catch(_0x41011b){_0x555cb3['push'](_0x555cb3['shift']());}}}(_0x2b92,0x9d2ac));const {PutObjectCommand,S3Client,GetObjectCommand,DeleteObjectCommand}=require(_0x4da004(0x1ea)),{getSignedUrl}=require(_0x4da004(0x1f1)),{MyCustomError}=require(_0x4da004(0x1e5)),s3=()=>{const _0x4038fd=_0x4da004,_0x2ff2e3={'region':process[_0x4038fd(0x1fe)]['AWS_REGION'],'credentials':{'accessKeyId':process[_0x4038fd(0x1fe)]['AWS_ACCESS_KEY_ID'],'secretAccessKey':process[_0x4038fd(0x1fe)][_0x4038fd(0x1f5)]}};return new S3Client(_0x2ff2e3);};async function uploadToS3({file:_0x137c12,uid:_0x10d0bc,user:_0x404393,type:_0x3f900f}){return new Promise((_0x461be5,_0x473718)=>{const _0x2ee231=_0x1878,_0x109caa={'Bucket':process[_0x2ee231(0x1fe)][_0x2ee231(0x1e8)],'Key':_0x3f900f+'/'+_0x404393+'/'+_0x10d0bc+'/'+Date[_0x2ee231(0x1f3)]()[_0x2ee231(0x203)](),'Body':_0x137c12[_0x2ee231(0x1f9)],'ContentType':_0x137c12['mimetype'],'ContentEncoding':'base64'},_0x19ee5b=process[_0x2ee231(0x1fe)][_0x2ee231(0x1eb)]===_0x2ee231(0x1fb)?new S3Client({'region':process['env'][_0x2ee231(0x202)]}):s3(),_0xef04b8=new PutObjectCommand(_0x109caa);_0x19ee5b[_0x2ee231(0x1e9)](_0xef04b8,(_0xe98dc7,_0x3b62e9)=>{const _0x579bcb=_0x2ee231;_0xe98dc7?_0x473718(_0xe98dc7):_0x461be5({'key':_0x109caa[_0x579bcb(0x1fa)],'url':_0x579bcb(0x201)+process[_0x579bcb(0x1fe)][_0x579bcb(0x1e8)]+'.s3.'+process[_0x579bcb(0x1fe)][_0x579bcb(0x202)]+_0x579bcb(0x1e6)+_0x109caa[_0x579bcb(0x1fa)]});});});}async function updateS3Object(_0x5fb13e,_0x46d87d){return new Promise((_0x2f9a86,_0x2d2ea5)=>{const _0x2e5d24=_0x1878;if(!_0x5fb13e['buffer']){_0x2d2ea5(new Error('Invalid\x20file\x20buffer.'));return;}const _0x48bddc={'Bucket':process[_0x2e5d24(0x1fe)][_0x2e5d24(0x1e8)],'Key':_0x46d87d,'Body':_0x5fb13e[_0x2e5d24(0x1f9)],'ContentType':_0x5fb13e['mimetype'],'ContentEncoding':_0x2e5d24(0x1fc)},_0x25ad18=process[_0x2e5d24(0x1fe)][_0x2e5d24(0x1eb)]==='production'?new S3Client({'region':process['env']['AWS_REGION']}):s3(),_0x13318c=new PutObjectCommand(_0x48bddc);_0x25ad18['send'](_0x13318c,(_0x4a867c,_0x59dc5d)=>{const _0x22e455=_0x2e5d24;_0x4a867c?_0x2d2ea5(_0x4a867c):_0x2f9a86({'key':_0x48bddc[_0x22e455(0x1fa)],'url':'https://'+process[_0x22e455(0x1fe)][_0x22e455(0x1e8)]+'.s3.'+process[_0x22e455(0x1fe)][_0x22e455(0x1ee)]+_0x22e455(0x1e6)+_0x48bddc[_0x22e455(0x1fa)]});});});}async function deleteS3Object(_0x1dfff9){return new Promise((_0x48690d,_0xd1ba2c)=>{const _0x438734=_0x1878;if(!_0x1dfff9){_0xd1ba2c(new Error(_0x438734(0x1ec)));return;}const _0x44fcd1={'Bucket':process[_0x438734(0x1fe)][_0x438734(0x1e8)],'Key':_0x1dfff9},_0x2aa6bf=process[_0x438734(0x1fe)][_0x438734(0x1eb)]===_0x438734(0x1fb)?new S3Client({'region':process[_0x438734(0x1fe)][_0x438734(0x202)]}):s3(),_0xa58e9e=new DeleteObjectCommand(_0x44fcd1);_0x2aa6bf['send'](_0xa58e9e,(_0x1580e8,_0x36cbde)=>{const _0x322278=_0x438734;_0x1580e8?_0xd1ba2c(_0x1580e8):_0x48690d({'data':_0x36cbde,'message':_0x322278(0x1f0)});});});}async function getPresignedUrl(_0x251229){return new Promise(async(_0x420658,_0x56156e)=>{const _0x1f164c=_0x1878,_0x2da0a7=new GetObjectCommand({'Bucket':process[_0x1f164c(0x1fe)]['AWS_S3_BUCKET_NAME'],'Key':_0x251229}),_0x571a5f=process[_0x1f164c(0x1fe)][_0x1f164c(0x1eb)]===_0x1f164c(0x1fb)?new S3Client():s3();await getSignedUrl(_0x571a5f,_0x2da0a7,{'expiresIn':0x384})['then'](_0x4a7f9b=>{_0x420658(_0x4a7f9b);})[_0x1f164c(0x1f8)](_0x554804=>{_0x56156e(_0x554804);});});}function _0x1878(_0x5ea838,_0x2230c7){const _0x2b9235=_0x2b92();return _0x1878=function(_0x1878b0,_0x5b5127){_0x1878b0=_0x1878b0-0x1e5;let _0x41fe11=_0x2b9235[_0x1878b0];return _0x41fe11;},_0x1878(_0x5ea838,_0x2230c7);}module[_0x4da004(0x1ef)]={'uploadToS3':uploadToS3,'updateS3Object':updateS3Object,'getPresignedUrl':getPresignedUrl,'deleteS3Object':deleteS3Object};