const _0x3f4f54=_0x5282;(function(_0x118dd0,_0x42ea3d){const _0x218553=_0x5282,_0x3f6a56=_0x118dd0();while(!![]){try{const _0x2db203=parseInt(_0x218553(0x1ab))/0x1*(-parseInt(_0x218553(0x1d7))/0x2)+parseInt(_0x218553(0x1ea))/0x3+-parseInt(_0x218553(0x1f8))/0x4+-parseInt(_0x218553(0x1ae))/0x5*(-parseInt(_0x218553(0x1f9))/0x6)+parseInt(_0x218553(0x1af))/0x7+-parseInt(_0x218553(0x1ba))/0x8*(parseInt(_0x218553(0x1c1))/0x9)+-parseInt(_0x218553(0x1c8))/0xa;if(_0x2db203===_0x42ea3d)break;else _0x3f6a56['push'](_0x3f6a56['shift']());}catch(_0x4595c4){_0x3f6a56['push'](_0x3f6a56['shift']());}}}(_0x5559,0x668ce));function _0x5282(_0x1fcf55,_0x283664){const _0x5559e3=_0x5559();return _0x5282=function(_0x5282b7,_0x5f0c52){_0x5282b7=_0x5282b7-0x1a9;let _0x2957c4=_0x5559e3[_0x5282b7];return _0x2957c4;},_0x5282(_0x1fcf55,_0x283664);}const asyncHandler=require(_0x3f4f54(0x1e3)),Agent=require(_0x3f4f54(0x1be)),jwt=require(_0x3f4f54(0x1d6)),mongoose=require(_0x3f4f54(0x1de)),{uploadToS3,getPresignedUrl,updateS3Object}=require('../aws/s3'),{MyCustomError}=require('../middlewares/error/error.handler'),speakeasy=require(_0x3f4f54(0x1c2)),{verifyOtp}=require(_0x3f4f54(0x1d3)),createAgent=asyncHandler(async(_0x59d2f6,_0x56a228,_0x10ff14)=>{const _0x4f97c8=_0x3f4f54,_0x2f480f=await mongoose[_0x4f97c8(0x1e9)]();try{_0x2f480f['startTransaction']();const {name:_0x143d99,phoneNumber:_0x2ffb16,address:_0xba968e,email:_0x362de0,gender:_0xaca2c6,dob:_0x2033aa,pan:_0x2c0eb7,aadhar:_0x5a44a9,accNo:_0x5ffdf8,cat:_0x221d06,password:_0x32fefb,ifscCode:_0x759092,bankName:_0x460698,branchName:_0x10c7a4}=_0x59d2f6[_0x4f97c8(0x1e1)],_0x2f379c=new Agent({'name':_0x143d99,'phoneNumber':_0x2ffb16,'address':_0xba968e,'email':_0x362de0,'gender':_0xaca2c6,'dob':_0x2033aa,'pan':_0x2c0eb7[_0x4f97c8(0x1aa)](),'aadhar':_0x5a44a9,'accNo':_0x5ffdf8,'cat':_0x221d06,'ifscCode':_0x759092,'bankName':_0x460698,'branchName':_0x10c7a4,'password':_0x32fefb});await _0x2f379c[_0x4f97c8(0x1f2)]({'session':_0x2f480f})[_0x4f97c8(0x1eb)](async _0x184fec=>{const _0x3b537a=_0x4f97c8;if(!_0x184fec['agentUid'])return await _0x2f480f[_0x3b537a(0x1b0)](),_0x10ff14(new MyCustomError(0x1f4,_0x3b537a(0x1d5)));const _0x117fc7=_0x59d2f6[_0x3b537a(0x1f7)],_0x125c64={};_0x117fc7?.['forEach'](_0x41d2b0=>{const {fieldname:_0x1c9500}=_0x41d2b0;!_0x125c64[_0x1c9500]&&(_0x125c64[_0x1c9500]=[]),_0x125c64[_0x1c9500]['push'](_0x41d2b0);});if(_0x125c64?.[_0x3b537a(0x1ca)]?.[_0x3b537a(0x1cc)]>0x0){if(_0x125c64[_0x3b537a(0x1ca)][0x0][_0x3b537a(0x1f4)]>0x400*0x400*0x2)return await _0x2f480f[_0x3b537a(0x1b0)](),_0x10ff14(new MyCustomError(0x19d,_0x3b537a(0x1fb)));_0x2f379c[_0x3b537a(0x1ca)]=await uploadToS3({'file':_0x125c64[_0x3b537a(0x1ca)][0x0],'uid':_0x184fec[_0x3b537a(0x1c5)],'user':'agent','type':_0x3b537a(0x1ca)}),await _0x2f379c[_0x3b537a(0x1f2)]({'session':_0x2f480f});}await _0x2f480f[_0x3b537a(0x1df)](),_0x56a228[_0x3b537a(0x1ac)](0xc9)[_0x3b537a(0x1c7)]({'message':'Agent\x20created\x20successfully','agent':_0x2f379c});});}catch(_0x490b51){await _0x2f480f[_0x4f97c8(0x1b0)](),_0x10ff14(_0x490b51);}finally{await _0x2f480f['endSession']();}}),agentLogin=asyncHandler(async(_0xb5571f,_0x4dd90a,_0x3b80d7)=>{const _0x2dc6c5=_0x3f4f54;try{const {emailOrPhoneNumber:_0x4846c6,password:_0x4d13dd}=_0xb5571f[_0x2dc6c5(0x1e1)],_0x339dbc=await Agent[_0x2dc6c5(0x1dd)](_0x4846c6,_0x4d13dd),_0xaa6a=jwt['sign']({'id':_0x339dbc[_0x2dc6c5(0x1b5)],'email':_0x339dbc[_0x2dc6c5(0x1ed)],'phoneNumber':_0x339dbc[_0x2dc6c5(0x1fe)],'role':_0x2dc6c5(0x1e0)},process[_0x2dc6c5(0x1ff)][_0x2dc6c5(0x1bc)],{'expiresIn':'1h'});_0x4dd90a[_0x2dc6c5(0x1ac)](0xc8)[_0x2dc6c5(0x1c7)]({'agent':_0x339dbc,'token':_0xaa6a});}catch(_0x44581a){_0x3b80d7(_0x44581a);}}),getAgentList=asyncHandler(async(_0x3d1655,_0x32654d,_0x21e733)=>{const _0x538054=_0x3f4f54;try{const {sortType:_0x4445ac,asc:asc=_0x538054(0x1c3),page:page=0x1,limit:limit=0xa,search:search='',deleteStatus:deleteStatus=_0x538054(0x1e6)}=_0x3d1655[_0x538054(0x1b8)],_0x3ee8ae={};if(_0x4445ac)_0x3ee8ae[_0x4445ac]=asc===_0x538054(0x1c3)?0x1:-0x1;const _0x4f986e=_0x3d1655[_0x538054(0x1b8)][_0x538054(0x1b1)]?new Date(_0x3d1655[_0x538054(0x1b8)][_0x538054(0x1b1)]+_0x538054(0x1c0)):new Date(_0x538054(0x1b7)),_0x327b1a=_0x3d1655[_0x538054(0x1b8)][_0x538054(0x1b2)]?new Date(_0x3d1655['query'][_0x538054(0x1b2)]+_0x538054(0x1bf)):new Date();await Agent[_0x538054(0x1dc)]([{'$match':{'$and':[{'$or':[{'name':{'$regex':search,'$options':'i'}},{'phoneNumber':{'$regex':search,'$options':'i'}}]},{'deleteStatus':deleteStatus}]}},{'$lookup':{'from':_0x538054(0x200),'localField':'_id','foreignField':'agent','as':_0x538054(0x200),'let':{'startDate':_0x4f986e,'endDate':_0x327b1a},'pipeline':[{'$match':{'$expr':{'$and':[{'$gte':['$createdAt',_0x538054(0x1fd)]},{'$lte':['$createdAt',_0x538054(0x1db)]}]}}},{'$lookup':{'from':_0x538054(0x1d4),'localField':_0x538054(0x1a9),'foreignField':_0x538054(0x1b5),'as':'store','pipeline':[{'$project':{'agentPercentage':0x1}}]}},{'$unwind':_0x538054(0x1ad)},{'$project':{'store':0x1,'amount':0x1}}]}},{'$addFields':{'totalCommission':{'$sum':{'$map':{'input':_0x538054(0x1d9),'as':'commission','in':{'$multiply':['$$commission.amount',{'$divide':['$$commission.store.agentPercentage',0x64]}]}}}}}},{'$project':{'commissions':0x0}},{'$sort':{..._0x3ee8ae,'agentUid':-0x1}},{'$facet':{'totalCommission':[{'$group':{'_id':null,'commissions':{'$sum':{'$ifNull':[_0x538054(0x202),0x0]}}}}],'documentCount':[{'$count':_0x538054(0x1d1)}],'agentList':[{'$skip':(+page-0x1)*+limit},{'$limit':+limit}]}},{'$project':{'agentList':0x1,'documentCount':{'$arrayElemAt':[_0x538054(0x1d2),0x0]},'totalCommission':0x1}}])['collation']({'locale':_0x538054(0x1e2),'numericOrdering':!![]})[_0x538054(0x1eb)](_0x336e88=>{const _0x4ea5a5=_0x538054;Promise['all'](_0x336e88[0x0]?.['agentList']?.[_0x4ea5a5(0x1ef)](async _0x4e3971=>{if(_0x4e3971['profilePic']){const _0x1356d5=await getPresignedUrl(_0x4e3971['profilePic']['key']);return{..._0x4e3971,'profilePic':{..._0x4e3971['profilePic'],'url':_0x1356d5}};}else return _0x4e3971;}))[_0x4ea5a5(0x1eb)](_0x251226=>{const _0xd8b5eb=_0x4ea5a5;_0x32654d['status'](0xc8)['json']({'agentList':_0x251226,'documentCount':_0x336e88[0x0]?.[_0xd8b5eb(0x1b4)]||0x0,'totalCommission':_0x336e88[0x0]?.[_0xd8b5eb(0x1b3)][0x0]||0x0,'page':+page,'limit':+limit,'order':asc===_0xd8b5eb(0x1c3)?_0xd8b5eb(0x1da):'desc','sortType':_0x4445ac||_0xd8b5eb(0x1c5)});});});}catch(_0x13d29e){_0x21e733(_0x13d29e);}}),getOneAgent=asyncHandler(async(_0x5489d6,_0x4ae140,_0x5ea7ad)=>{const _0x5f34d0=_0x3f4f54,{id:_0x5470f2}=_0x5489d6[_0x5f34d0(0x1ec)];if(_0x5489d6[_0x5f34d0(0x1ee)][_0x5f34d0(0x1d8)]===_0x5f34d0(0x1e0)&&_0x5489d6['user'][_0x5f34d0(0x1b5)][_0x5f34d0(0x1d0)]()!==_0x5470f2)return _0x5ea7ad(new MyCustomError(0x193,_0x5f34d0(0x1fa)));try{await Agent[_0x5f34d0(0x1bb)](_0x5470f2)[_0x5f34d0(0x1eb)](async _0xee2f32=>{const _0x8dfdc7=_0x5f34d0;if(!_0xee2f32)return _0x5ea7ad(new MyCustomError(0x194,_0x8dfdc7(0x201)));if(_0xee2f32['profilePic']){const _0x51254b=await getPresignedUrl(_0xee2f32[_0x8dfdc7(0x1ca)][_0x8dfdc7(0x1cb)]);_0xee2f32[_0x8dfdc7(0x1ca)][_0x8dfdc7(0x1f5)]=_0x51254b;}_0x4ae140['status'](0xc8)[_0x8dfdc7(0x1c7)]({'agent':_0xee2f32});});}catch(_0x3e65f0){_0x5ea7ad(_0x3e65f0);}}),updateAgent=asyncHandler(async(_0x1f993b,_0x36169a,_0x1f5f1e)=>{const _0x346906=_0x3f4f54,{id:_0x17d1c8}=_0x1f993b[_0x346906(0x1ec)];if(_0x1f993b[_0x346906(0x1ee)][_0x346906(0x1d8)]===_0x346906(0x1e0)&&_0x1f993b[_0x346906(0x1ee)][_0x346906(0x1b5)][_0x346906(0x1d0)]()!==_0x17d1c8)return _0x1f5f1e(new MyCustomError(0x193,_0x346906(0x1fa)));try{await Agent[_0x346906(0x1bb)](_0x17d1c8)[_0x346906(0x1eb)](async _0x52f69f=>{const _0x5ebbf7=_0x346906;if(!_0x52f69f)return _0x1f5f1e(new MyCustomError(0x194,_0x5ebbf7(0x201)));for(let _0x2bf3ce in _0x1f993b[_0x5ebbf7(0x1e1)]){_0x52f69f[_0x2bf3ce]=_0x1f993b[_0x5ebbf7(0x1e1)][_0x2bf3ce];}const _0x242388=_0x1f993b[_0x5ebbf7(0x1f7)],_0x24e4ba={};_0x242388?.['forEach'](_0x2da7dc=>{const {fieldname:_0x2412be}=_0x2da7dc;!_0x24e4ba[_0x2412be]&&(_0x24e4ba[_0x2412be]=[]),_0x24e4ba[_0x2412be]['push'](_0x2da7dc);});if(_0x24e4ba?.[_0x5ebbf7(0x1ca)]?.['length']>0x0){if(_0x24e4ba['profilePic'][0x0][_0x5ebbf7(0x1f4)]>0x400*0x400*0x2)return _0x1f5f1e(new MyCustomError(0x19d,_0x5ebbf7(0x1fb)));_0x52f69f[_0x5ebbf7(0x1ca)]?_0x52f69f[_0x5ebbf7(0x1ca)]=await updateS3Object(_0x24e4ba['profilePic'][0x0],_0x52f69f[_0x5ebbf7(0x1ca)][_0x5ebbf7(0x1cb)]):_0x52f69f[_0x5ebbf7(0x1ca)]=await uploadToS3({'file':_0x24e4ba['profilePic'][0x0],'uid':_0x52f69f['agentUid'],'user':_0x5ebbf7(0x1e0),'type':_0x5ebbf7(0x1ca)});}await _0x52f69f[_0x5ebbf7(0x1f2)](),_0x36169a[_0x5ebbf7(0x1c7)]({'message':_0x5ebbf7(0x1f0),'agent':_0x52f69f});});}catch(_0x3808ae){_0x1f5f1e(_0x3808ae);}}),forgotPassword=asyncHandler(async(_0x5c2a91,_0x49e554,_0x1f6bc5)=>{const _0x6548eb=_0x3f4f54,{emailOrPhoneNumber:_0x3d6c52,newPassword:_0x55a4ce,secret:_0x3ceae7,otp:_0x20db66}=_0x5c2a91['body'];try{if(!_0x3ceae7||!_0x20db66)return _0x1f6bc5(new MyCustomError(0x190,_0x6548eb(0x1f1)));const {valid:_0x1d0424,verified:_0x7e1fd8}=verifyOtp(_0x3ceae7,_0x20db66);if(!_0x7e1fd8||!_0x1d0424){if(!_0x1d0424)return _0x1f6bc5(new MyCustomError(0x190,_0x6548eb(0x1f3)));return _0x1f6bc5(new MyCustomError(0x190,_0x6548eb(0x1bd)));}const _0x1da1a6=await Agent[_0x6548eb(0x1e8)]({'$or':[{'email':_0x3d6c52},{'phoneNumber':_0x3d6c52}]});if(!_0x1da1a6)throw new MyCustomError(0x190,_0x6548eb(0x1cd));_0x1da1a6[_0x6548eb(0x1e5)]=_0x55a4ce,await _0x1da1a6[_0x6548eb(0x1f2)](),_0x49e554[_0x6548eb(0x1c7)](_0x1da1a6);}catch(_0xe2c7f7){_0x1f6bc5(_0xe2c7f7);}}),deleteManyAgent=asyncHandler(async(_0x2187d3,_0x296868,_0x11b7ec)=>{const _0x54d2a1=_0x3f4f54,{idArray:_0x57f8a4}=_0x2187d3[_0x54d2a1(0x1e1)],_0x30c2bf=await mongoose['startSession']();try{_0x30c2bf[_0x54d2a1(0x1b9)]();const _0xd91f94=await Promise[_0x54d2a1(0x1cf)](_0x57f8a4[_0x54d2a1(0x1ef)](async _0x3d9410=>{const _0x3810eb=_0x54d2a1;if(!mongoose[_0x3810eb(0x1ce)](_0x3d9410))throw new MyCustomError(0x190,_0x3810eb(0x1fc));const _0x3cafb3=await Agent[_0x3810eb(0x1b6)](_0x3d9410,{'deleteStatus':'true'},{'returnDocument':_0x3810eb(0x1c9),'select':_0x3810eb(0x1e4)});if(!_0x3cafb3)throw new MyCustomError(0x190,_0x3810eb(0x1e7));return _0x3cafb3;}));_0x296868[_0x54d2a1(0x1c7)]({'message':_0x57f8a4['length']+_0x54d2a1(0x1f6),'result':_0xd91f94});}catch(_0x21790f){await _0x30c2bf[_0x54d2a1(0x1b0)](),_0x11b7ec(_0x21790f);}finally{_0x30c2bf[_0x54d2a1(0x1c6)]();}}),restoreManyAgent=asyncHandler(async(_0x4b4aa4,_0xb0739c,_0x2a357d)=>{const _0x542d7d=_0x3f4f54,{idArray:_0x2d47dc}=_0x4b4aa4['body'],_0x343e6c=await mongoose[_0x542d7d(0x1e9)]();try{_0x343e6c['startTransaction']();const _0x5364d7=await Promise[_0x542d7d(0x1cf)](_0x2d47dc['map'](async _0xe44832=>{const _0x1fd3e7=_0x542d7d;if(!mongoose['isValidObjectId'](_0xe44832))throw new MyCustomError(0x190,_0x1fd3e7(0x1fc));const _0x2792f6=await Agent[_0x1fd3e7(0x1b6)](_0xe44832,{'deleteStatus':_0x1fd3e7(0x1e6)},{'returnDocument':_0x1fd3e7(0x1c9),'select':_0x1fd3e7(0x1e4)});if(!_0x2792f6)throw new MyCustomError(0x190,_0x1fd3e7(0x1fc));return _0x2792f6;}));_0xb0739c[_0x542d7d(0x1c7)]({'message':_0x2d47dc[_0x542d7d(0x1cc)]+'\x20Agent(s)\x20Restored\x20successfully','result':_0x5364d7});}catch(_0x382581){await _0x343e6c[_0x542d7d(0x1b0)](),_0x2a357d(_0x382581);}finally{_0x343e6c[_0x542d7d(0x1c6)]();}});module[_0x3f4f54(0x1c4)]={'createAgent':createAgent,'agentLogin':agentLogin,'getAgentList':getAgentList,'getOneAgent':getOneAgent,'updateAgent':updateAgent,'deleteManyAgent':deleteManyAgent,'restoreManyAgent':restoreManyAgent,'forgotPassword':forgotPassword};function _0x5559(){const _0xb8c3e7=['user','map','Agent\x20updated\x20successfully','Invalid\x20Request\x20send\x20secret\x20and\x20otp','save','Invalid\x20or\x20Expried\x20OTP','size','url','\x20Agent(s)\x20Deleted\x20successfully','files','421356HbGgai','1014SRBjFB','Access\x20denied.\x20Insufficient\x20permissions.','File\x20Too\x20Large','Agent(s)\x20provided\x20is\x20invalid','$$startDate','phoneNumber','env','commissions','Agent\x20not\x20found.','$totalCommission','store','toUpperCase','33771vZYtbx','status','$store','21065WvTXHd','5480181eTpgqV','abortTransaction','startDate','endDate','totalCommission','documentCount','_id','findByIdAndUpdate','1970-01-01','query','startTransaction','64424szNwtJ','findById','JWT_SECRET_KEY','OTP\x20Expried','../models/agent.model','T23:59:59.999+05:30','T00:00:00.000+05:30','117jZioLK','speakeasy','true','exports','agentUid','endSession','json','8677420FrCtzB','after','profilePic','key','length','agent\x20not\x20found','isValidObjectId','all','toString','total','$documentCount.total','../helper/otpVerification','stores','Error\x20while\x20creating\x20Agent','jsonwebtoken','2leNtAV','role','$commissions','asc','$$endDate','aggregate','login','mongoose','commitTransaction','agent','body','en_US','express-async-handler','_id\x20name','password','false','Agent(s)\x20is\x20not\x20Present','findOne','startSession','110121azOUVq','then','params','email'];_0x5559=function(){return _0xb8c3e7;};return _0x5559();}