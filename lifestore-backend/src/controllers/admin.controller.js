const _0x3fde2f=_0x1938;function _0xa8f5(){const _0x1f4ea3=['after','login','adminUid','267RGBUWl','../helper/otpVerification','_id\x20name','findOne','true','42363QiVioI','Invalid\x20Request\x20send\x20secret\x20and\x20otp','asc','_id','admin','total','password','length','exists','query','commitTransaction','5238650XhSRDM','OTP\x20Expried','Please\x20provide\x20phone\x20number','generateSecret','profilePic','Admin\x20not\x20found.','json','collation','map','Invalid\x20or\x20Expried\x20OTP','key','../aws/s3','base32','desc','isValidObjectId','then','speakeasy','92310Nxxrbb','forEach','\x20Admin(s)\x20Restored\x20successfully','startTransaction','params','env','../aws/sns','findById','+91','../models/agent.model','startSession','abortTransaction','all','31492GXamGN','findByIdAndUpdate','sign','admin\x20not\x20found','body','\x20is\x20OTP\x20for\x20your\x20Lifestores\x20login.\x20OTP\x20valid\x20for\x2010\x20minutes.\x20Do\x20not\x20share\x20this\x20OTP\x20with\x20anyone.','Admin(s)\x20provided\x20is\x20invalid','save','files','18Mrtopu','exports','size','244251bxFocf','\x20Admin(s)\x20Deleted\x20successfully','Admin\x20updated\x20successfully','push','endSession','url','344iURHeQ','totp','jsonwebtoken','Phone\x20Number\x20doesnot\x20exists','File\x20Too\x20Large','aggregate','3143076ijHhJo','6126666hbPAUV','status'];_0xa8f5=function(){return _0x1f4ea3;};return _0xa8f5();}(function(_0x14415b,_0x3879a2){const _0x6cc852=_0x1938,_0x14b87d=_0x14415b();while(!![]){try{const _0x22ce9d=parseInt(_0x6cc852(0x13a))/0x1*(parseInt(_0x6cc852(0x120))/0x2)+parseInt(_0x6cc852(0x135))/0x3*(parseInt(_0x6cc852(0x117))/0x4)+parseInt(_0x6cc852(0x145))/0x5+parseInt(_0x6cc852(0x12f))/0x6+-parseInt(_0x6cc852(0x130))/0x7+-parseInt(_0x6cc852(0x129))/0x8*(parseInt(_0x6cc852(0x123))/0x9)+parseInt(_0x6cc852(0x10a))/0xa;if(_0x22ce9d===_0x3879a2)break;else _0x14b87d['push'](_0x14b87d['shift']());}catch(_0x51895d){_0x14b87d['push'](_0x14b87d['shift']());}}}(_0xa8f5,0x9780c));function _0x1938(_0x3e1d4d,_0x47b9a9){const _0xa8f520=_0xa8f5();return _0x1938=function(_0x1938ba,_0x40722c){_0x1938ba=_0x1938ba-0x102;let _0x53fb84=_0xa8f520[_0x1938ba];return _0x53fb84;},_0x1938(_0x3e1d4d,_0x47b9a9);}const asyncHandler=require('express-async-handler'),Admin=require('../models/admin.model'),Store=require('../models/store.model'),Agent=require(_0x3fde2f(0x113)),jwt=require(_0x3fde2f(0x12b)),speakeasy=require(_0x3fde2f(0x109)),mongoose=require('mongoose'),{uploadToS3,getPresignedUrl,updateS3Object}=require(_0x3fde2f(0x104)),{MyCustomError}=require('../middlewares/error/error.handler'),{sendMessage}=require(_0x3fde2f(0x110)),{verifyOtp}=require(_0x3fde2f(0x136)),createAdmin=asyncHandler(async(_0x47bdd0,_0x1d5c4e,_0x124d0c)=>{const _0x86f12a=_0x3fde2f,_0x5c8a59=await mongoose['startSession']();try{_0x5c8a59['startTransaction']();const {name:_0x244aed,phoneNumber:_0x365cac,address:_0x1503a0,email:_0x54df4c,gender:_0x3ba82b,dob:_0x3b7f43,password:_0xa21cd2}=_0x47bdd0[_0x86f12a(0x11b)],_0x8c25ac=new Admin({'name':_0x244aed,'phoneNumber':_0x365cac,'address':_0x1503a0,'email':_0x54df4c,'gender':_0x3ba82b,'dob':_0x3b7f43,'password':_0xa21cd2});await _0x8c25ac[_0x86f12a(0x11e)]({'session':_0x5c8a59})['then'](async _0x563ee7=>{const _0x1f5e01=_0x86f12a;if(!_0x563ee7['adminUid'])return await _0x5c8a59[_0x1f5e01(0x115)](),_0x124d0c(new MyCustomError(0x1f4,'Error\x20while\x20creating\x20Admin'));const _0x131537=_0x47bdd0[_0x1f5e01(0x11f)],_0x3589c0={};_0x131537?.[_0x1f5e01(0x10b)](_0x3a86fb=>{const _0xa643ec=_0x1f5e01,{fieldname:_0x41c6e8}=_0x3a86fb;!_0x3589c0[_0x41c6e8]&&(_0x3589c0[_0x41c6e8]=[]),_0x3589c0[_0x41c6e8][_0xa643ec(0x126)](_0x3a86fb);});if(_0x3589c0?.[_0x1f5e01(0x149)]?.['length']>0x0){if(_0x3589c0['profilePic'][0x0][_0x1f5e01(0x122)]>0x400*0x400*0x2)return await _0x5c8a59[_0x1f5e01(0x115)](),_0x124d0c(new MyCustomError(0x19d,_0x1f5e01(0x12d)));_0x8c25ac[_0x1f5e01(0x149)]=await uploadToS3({'file':_0x3589c0[_0x1f5e01(0x149)][0x0],'uid':_0x563ee7[_0x1f5e01(0x134)],'user':_0x1f5e01(0x13e),'type':_0x1f5e01(0x149)}),await _0x8c25ac[_0x1f5e01(0x11e)]({'session':_0x5c8a59});}await _0x5c8a59[_0x1f5e01(0x144)](),_0x1d5c4e['status'](0xc9)[_0x1f5e01(0x14b)]({'message':'Admin\x20created\x20successfully','admin':_0x8c25ac});});}catch(_0x9c8537){await _0x5c8a59['abortTransaction'](),_0x124d0c(_0x9c8537);}finally{await _0x5c8a59[_0x86f12a(0x127)]();}}),adminLogin=asyncHandler(async(_0x409635,_0x543edc,_0x138d6c)=>{const _0x2de9cc=_0x3fde2f;try{const {emailOrPhoneNumber:_0x5d1d45,password:_0x196269}=_0x409635[_0x2de9cc(0x11b)],_0x1c8b78=await Admin[_0x2de9cc(0x133)](_0x5d1d45,_0x196269),_0x2df86e=jwt[_0x2de9cc(0x119)]({'id':_0x1c8b78[_0x2de9cc(0x13d)],'email':_0x1c8b78['email'],'phoneNumber':_0x1c8b78['phoneNumber'],'role':_0x2de9cc(0x13e)},process[_0x2de9cc(0x10f)]['JWT_SECRET_KEY'],{'expiresIn':'1h'});_0x543edc['status'](0xc8)['json']({'admin':_0x1c8b78,'token':_0x2df86e});}catch(_0x257526){_0x138d6c(_0x257526);}}),getAdminList=asyncHandler(async(_0x37e0e2,_0x4fa198,_0x535f4b)=>{const _0x21d6c0=_0x3fde2f;try{const {sortType:_0x383a71,asc:asc='true',page:page=0x1,limit:limit=0xa,search:search='',deleteStatus:deleteStatus='false'}=_0x37e0e2[_0x21d6c0(0x143)],_0x24b096={};if(_0x383a71)_0x24b096[_0x383a71]=asc==='true'?0x1:-0x1;await Admin[_0x21d6c0(0x12e)]([{'$match':{'$and':[{'$or':[{'name':{'$regex':search,'$options':'i'}},{'phoneNumber':{'$regex':search,'$options':'i'}}]},{'deleteStatus':deleteStatus}]}},{'$sort':{..._0x24b096,'adminUid':-0x1}},{'$facet':{'documentCount':[{'$count':_0x21d6c0(0x13f)}],'adminList':[{'$skip':(page-0x1)*+limit},{'$limit':+limit}]}},{'$project':{'adminList':0x1,'documentCount':{'$arrayElemAt':['$documentCount.total',0x0]}}}])[_0x21d6c0(0x14c)]({'locale':'en_US','numericOrdering':!![]})[_0x21d6c0(0x108)](_0x3f41e3=>{const _0x2bc9e9=_0x21d6c0;_0x4fa198[_0x2bc9e9(0x131)](0xc8)[_0x2bc9e9(0x14b)]({'adminList':_0x3f41e3[0x0]?.['adminList'],'documentCount':_0x3f41e3[0x0]?.['documentCount']||0x0,'page':+page,'limit':+limit,'order':asc===_0x2bc9e9(0x139)?_0x2bc9e9(0x13c):_0x2bc9e9(0x106),'sortType':_0x383a71||_0x2bc9e9(0x134)});});}catch(_0x43c812){_0x535f4b(_0x43c812);}}),getOneAdmin=asyncHandler(async(_0x2a1fad,_0xf6cf0b,_0x42247a)=>{const _0x22921e=_0x3fde2f,{id:_0x283585}=_0x2a1fad[_0x22921e(0x10e)];try{await Admin[_0x22921e(0x111)](_0x283585)[_0x22921e(0x108)](async _0x110f96=>{const _0x47d044=_0x22921e;if(!_0x110f96)return _0x42247a(new MyCustomError(0x194,'Admin\x20not\x20found.'));if(_0x110f96[_0x47d044(0x149)]){const _0x1c41f8=await getPresignedUrl(_0x110f96[_0x47d044(0x149)][_0x47d044(0x103)]);_0x110f96['profilePic'][_0x47d044(0x128)]=_0x1c41f8;}_0xf6cf0b[_0x47d044(0x131)](0xc8)[_0x47d044(0x14b)]({'admin':_0x110f96});});}catch(_0x3609fe){_0x42247a(_0x3609fe);}}),updateAdmin=asyncHandler(async(_0x646b82,_0x52f4a4,_0x26e690)=>{const _0xab5822=_0x3fde2f,{id:_0x3d641a}=_0x646b82[_0xab5822(0x10e)];try{await Admin[_0xab5822(0x111)](_0x3d641a)[_0xab5822(0x108)](async _0x34c554=>{const _0x100fc7=_0xab5822;if(!_0x34c554)return _0x26e690(new MyCustomError(0x194,_0x100fc7(0x14a)));for(let _0x27c98f in _0x646b82[_0x100fc7(0x11b)]){_0x34c554[_0x27c98f]=_0x646b82[_0x100fc7(0x11b)][_0x27c98f];}const _0x39eb43=_0x646b82[_0x100fc7(0x11f)],_0x464dab={};_0x39eb43?.[_0x100fc7(0x10b)](_0x29f181=>{const _0x19f3ab=_0x100fc7,{fieldname:_0x564b57}=_0x29f181;!_0x464dab[_0x564b57]&&(_0x464dab[_0x564b57]=[]),_0x464dab[_0x564b57][_0x19f3ab(0x126)](_0x29f181);});if(_0x464dab?.[_0x100fc7(0x149)]?.[_0x100fc7(0x141)]>0x0){if(_0x464dab[_0x100fc7(0x149)][0x0][_0x100fc7(0x122)]>0x400*0x400*0x2)return _0x26e690(new MyCustomError(0x19d,'File\x20Too\x20Large'));_0x34c554[_0x100fc7(0x149)]?_0x34c554[_0x100fc7(0x149)]=await updateS3Object(_0x464dab[_0x100fc7(0x149)][0x0],_0x34c554['profilePic'][_0x100fc7(0x103)]):_0x34c554[_0x100fc7(0x149)]=await uploadToS3({'file':_0x464dab[_0x100fc7(0x149)][0x0],'uid':_0x34c554[_0x100fc7(0x134)],'user':_0x100fc7(0x13e),'type':_0x100fc7(0x149)});}await _0x34c554[_0x100fc7(0x11e)]();if(_0x34c554['profilePic']){const _0x11534b=await getPresignedUrl(_0x34c554[_0x100fc7(0x149)][_0x100fc7(0x103)]);_0x34c554[_0x100fc7(0x149)][_0x100fc7(0x128)]=_0x11534b;}_0x52f4a4[_0x100fc7(0x14b)]({'message':_0x100fc7(0x125),'admin':_0x34c554});});}catch(_0x1f1952){_0x26e690(_0x1f1952);}}),forgotPassword=asyncHandler(async(_0x6ba18a,_0x2c99ef,_0x47e89e)=>{const _0x173103=_0x3fde2f,{emailOrPhoneNumber:_0xbfd51b,newPassword:_0x24ab47,secret:_0x54f4f2,otp:_0x4ae30d}=_0x6ba18a[_0x173103(0x11b)];try{if(!_0x54f4f2||!_0x4ae30d)return _0x47e89e(new MyCustomError(0x190,_0x173103(0x13b)));const {valid:_0x21d934,verified:_0xfdf69a}=verifyOtp(_0x54f4f2,_0x4ae30d);if(!_0xfdf69a||!_0x21d934){if(!_0x21d934)return _0x47e89e(new MyCustomError(0x190,_0x173103(0x102)));return _0x47e89e(new MyCustomError(0x190,_0x173103(0x146)));}const _0x18aa0d=await Admin[_0x173103(0x138)]({'$or':[{'email':_0xbfd51b},{'phoneNumber':_0xbfd51b}]});if(!_0x18aa0d)throw new MyCustomError(0x190,_0x173103(0x11a));_0x18aa0d[_0x173103(0x140)]=_0x24ab47,await _0x18aa0d['save'](),_0x2c99ef[_0x173103(0x14b)](_0x18aa0d);}catch(_0x19beb8){_0x47e89e(_0x19beb8);}}),deleteManyAdmin=asyncHandler(async(_0x1a6050,_0x372b41,_0x11fb29)=>{const _0x377cdf=_0x3fde2f,{idArray:_0x45f8ea}=_0x1a6050['body'],_0xfdc6d3=await mongoose[_0x377cdf(0x114)]();try{_0xfdc6d3[_0x377cdf(0x10d)]();const _0x27cb96=await Promise['all'](_0x45f8ea[_0x377cdf(0x14d)](async _0x40e514=>{const _0x28cd89=_0x377cdf;if(!mongoose[_0x28cd89(0x107)](_0x40e514))throw new MyCustomError(0x190,_0x28cd89(0x11d));const _0x2e06a8=await Admin[_0x28cd89(0x118)](_0x40e514,{'deleteStatus':_0x28cd89(0x139)},{'returnDocument':'after','select':_0x28cd89(0x137)});if(!_0x2e06a8)throw new MyCustomError(0x190,'Admin(s)\x20is\x20not\x20Present');return _0x2e06a8;}));_0x372b41[_0x377cdf(0x14b)]({'message':_0x45f8ea[_0x377cdf(0x141)]+_0x377cdf(0x124),'result':_0x27cb96});}catch(_0x16b723){await _0xfdc6d3[_0x377cdf(0x115)](),_0x11fb29(_0x16b723);}finally{_0xfdc6d3[_0x377cdf(0x127)]();}}),restoreManyAdmin=asyncHandler(async(_0x288eba,_0x4e68bb,_0x1b560e)=>{const _0x5e74d7=_0x3fde2f,{idArray:_0x9a2817}=_0x288eba['body'],_0x2fd6f1=await mongoose[_0x5e74d7(0x114)]();try{_0x2fd6f1[_0x5e74d7(0x10d)]();const _0x115f77=await Promise[_0x5e74d7(0x116)](_0x9a2817['map'](async _0x343b11=>{const _0x4cca8a=_0x5e74d7;if(!mongoose[_0x4cca8a(0x107)](_0x343b11))throw new MyCustomError(0x190,_0x4cca8a(0x11d));const _0x1b2071=await Admin['findByIdAndUpdate'](_0x343b11,{'deleteStatus':'false'},{'returnDocument':_0x4cca8a(0x132),'select':_0x4cca8a(0x137)});if(!_0x1b2071)throw new MyCustomError(0x190,_0x4cca8a(0x11d));return _0x1b2071;}));_0x4e68bb[_0x5e74d7(0x14b)]({'message':_0x9a2817[_0x5e74d7(0x141)]+_0x5e74d7(0x10c),'result':_0x115f77});}catch(_0x16be1d){await _0x2fd6f1[_0x5e74d7(0x115)](),_0x1b560e(_0x16be1d);}finally{_0x2fd6f1[_0x5e74d7(0x127)]();}}),sendOtp=asyncHandler(async(_0x464c52,_0x11c0b0,_0x118ed2)=>{const _0x45520a=_0x3fde2f,{phoneNumber:_0x20ca48}=_0x464c52[_0x45520a(0x11b)],_0x256bec=speakeasy[_0x45520a(0x148)]({'length':0x14}),_0x348b2f=speakeasy[_0x45520a(0x12a)]({'secret':_0x256bec[_0x45520a(0x105)],'encoding':_0x45520a(0x105)}),_0x4ef967=_0x348b2f+_0x45520a(0x11c);try{!_0x20ca48&&_0x118ed2(new MyCustomError(0x190,_0x45520a(0x147)));if(!(await Admin[_0x45520a(0x142)]({'phoneNumber':_0x20ca48})||await Store[_0x45520a(0x142)]({'phoneNumber':_0x20ca48})||await Agent[_0x45520a(0x142)]({'phoneNumber':_0x20ca48})))return _0x118ed2(new MyCustomError(0x190,_0x45520a(0x12c)));await sendMessage(_0x4ef967,_0x45520a(0x112)+_0x20ca48),_0x11c0b0[_0x45520a(0x14b)]({'message':'OTP\x20sent\x20successfully.','secret':_0x256bec[_0x45520a(0x105)]});}catch(_0x5ab2e1){_0x118ed2(_0x5ab2e1);}});module[_0x3fde2f(0x121)]={'createAdmin':createAdmin,'adminLogin':adminLogin,'getAdminList':getAdminList,'getOneAdmin':getOneAdmin,'updateAdmin':updateAdmin,'deleteManyAdmin':deleteManyAdmin,'restoreManyAdmin':restoreManyAdmin,'forgotPassword':forgotPassword,'sendOtp':sendOtp};