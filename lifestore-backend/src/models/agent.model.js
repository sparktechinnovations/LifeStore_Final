const _0x167043=_0x658d;function _0x658d(_0x4209e1,_0x46a087){const _0x36cb53=_0x36cb();return _0x658d=function(_0x658de3,_0x564aa0){_0x658de3=_0x658de3-0x1de;let _0xdfa0a6=_0x36cb53[_0x658de3];return _0xdfa0a6;},_0x658d(_0x4209e1,_0x46a087);}(function(_0x4702fe,_0x48d8d6){const _0x23e53e=_0x658d,_0x155a2a=_0x4702fe();while(!![]){try{const _0x5e085c=parseInt(_0x23e53e(0x1fb))/0x1+-parseInt(_0x23e53e(0x1fd))/0x2*(-parseInt(_0x23e53e(0x1ef))/0x3)+-parseInt(_0x23e53e(0x1e9))/0x4*(-parseInt(_0x23e53e(0x1f7))/0x5)+parseInt(_0x23e53e(0x1f4))/0x6+parseInt(_0x23e53e(0x1f6))/0x7+-parseInt(_0x23e53e(0x1e3))/0x8+-parseInt(_0x23e53e(0x1f0))/0x9;if(_0x5e085c===_0x48d8d6)break;else _0x155a2a['push'](_0x155a2a['shift']());}catch(_0x4688a1){_0x155a2a['push'](_0x155a2a['shift']());}}}(_0x36cb,0xd4eb3));const mongoose=require(_0x167043(0x1ea)),bcrypt=require('bcrypt'),{MyCustomError}=require(_0x167043(0x1f3)),uniqueValidator=require('mongoose-unique-validator'),{getPresignedUrl}=require(_0x167043(0x1ff)),s3ObjectSchema=new mongoose[(_0x167043(0x202))]({'key':String,'url':String}),agentSchema=new mongoose[(_0x167043(0x202))]({'name':{'type':String,'required':!![]},'phoneNumber':{'type':String,'required':!![],'unique':!![]},'address':String,'email':{'type':String},'agentUid':{'type':String,'unique':!![]},'gender':{'type':String,'enum':[_0x167043(0x1ec),'Female',_0x167043(0x1e8)]},'dob':{'type':Date,'required':!![],'validate':{'validator':function(_0x18a757){const _0x189bd1=_0x167043,_0x52be9a=new Date(),_0x172370=_0x52be9a[_0x189bd1(0x1eb)]()-_0x18a757[_0x189bd1(0x1eb)]();return _0x172370>=0x12&&_0x18a757<=_0x52be9a;},'message':_0x167043(0x1ed)}},'pan':{'type':String,'required':!![],'unique':!![]},'aadhar':{'type':String,'required':!![],'unique':!![]},'accNo':{'type':String,'required':!![],'unique':!![]},'cat':{'type':String,'enum':[_0x167043(0x1fa),'Other']},'password':{'type':String,'required':!![]},'deleteStatus':{'type':String,'default':'false','enum':[_0x167043(0x1e2),_0x167043(0x203)]},'ifscCode':{'type':String,'required':!![]},'bankName':{'type':String,'required':!![]},'branchName':{'type':String,'required':!![]},'anniversary':Date,'profilePic':s3ObjectSchema},{'timestamps':!![]});agentSchema[_0x167043(0x1e5)]({'email':0x1},{'unique':!![],'sparse':!![]}),agentSchema[_0x167043(0x1e5)]({'name':0x1,'phoneNumber':0x1,'deleteStatus':0x1}),agentSchema[_0x167043(0x1e5)]({'email':0x1,'phoneNumber':0x1}),agentSchema[_0x167043(0x1f2)](uniqueValidator,{'message':_0x167043(0x1f5)});async function generateAgentUid(){const _0x4ae933=_0x167043,_0x96195c=this['model']('Agent'),_0x29b4ca=await _0x96195c[_0x4ae933(0x1de)]({},{'agentUid':0x1},{'sort':{'agentUid':-0x1}});let _0x4bbdd5=_0x4ae933(0x1ee);if(_0x29b4ca){const _0x591a10=parseInt(_0x29b4ca[_0x4ae933(0x1e0)],0xa);_0x4bbdd5=(_0x591a10+0x1)['toString']()[_0x4ae933(0x1e4)](0x8,'0');}return _0x4bbdd5;}function _0x36cb(){const _0x529780=['mongoose','getFullYear','Male','Invalid\x20DOB.\x20Agent\x20must\x20be\x20at\x20least\x2018\x20years\x20old\x20and\x20DOB\x20cannot\x20be\x20in\x20the\x20future.','00000001','3WgyQKU','42226596CjSsGa','password','plugin','../middlewares/error/error.handler','8877948CQWJpH','{PATH}\x20already\x20exists.','10019044pZARtt','5065YSisVN','key','save','LIC','971457EVxLAa','Invalid\x20credentials','414872YRqcfK','isModified','../aws/s3','url','statics','Schema','false','profilePic','findOne','compare','agentUid','call','true','395488uiWqdt','padStart','index','model','login','Other','6016DeWXah'];_0x36cb=function(){return _0x529780;};return _0x36cb();}agentSchema['pre'](_0x167043(0x1f9),async function(_0x4c025e){const _0x3df6e6=_0x167043;try{!this[_0x3df6e6(0x1e0)]&&(this[_0x3df6e6(0x1e0)]=await generateAgentUid[_0x3df6e6(0x1e1)](this));if(!this[_0x3df6e6(0x1fe)](_0x3df6e6(0x1f1)))return _0x4c025e();const _0x4e98e3=0xa,_0x231a27=await bcrypt['hash'](this[_0x3df6e6(0x1f1)],_0x4e98e3);this['password']=_0x231a27,_0x4c025e();}catch(_0x418a54){_0x4c025e(_0x418a54);}}),agentSchema[_0x167043(0x201)][_0x167043(0x1e7)]=async function(_0x2dc5d6,_0x2b20df){const _0x2cb3ef=_0x167043,_0x7e36ac=await this[_0x2cb3ef(0x1de)]({'$or':[{'email':_0x2dc5d6},{'phoneNumber':_0x2dc5d6}]});if(!_0x7e36ac)throw new MyCustomError(0x190,_0x2cb3ef(0x1fc));const _0x329cad=await bcrypt[_0x2cb3ef(0x1df)](_0x2b20df,_0x7e36ac[_0x2cb3ef(0x1f1)]);if(!_0x329cad)throw new MyCustomError(0x190,_0x2cb3ef(0x1fc));if(_0x7e36ac['profilePic']){const _0x3ac228=await getPresignedUrl(_0x7e36ac[_0x2cb3ef(0x204)][_0x2cb3ef(0x1f8)]);_0x7e36ac[_0x2cb3ef(0x204)][_0x2cb3ef(0x200)]=_0x3ac228;}return _0x7e36ac;},module['exports']=mongoose[_0x167043(0x1e6)]('Agent',agentSchema);