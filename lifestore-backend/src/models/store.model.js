function _0x3039(_0x1b1cfd,_0x568fa1){const _0x324dc5=_0x324d();return _0x3039=function(_0x30399d,_0xc733b){_0x30399d=_0x30399d-0x14e;let _0x3530e8=_0x324dc5[_0x30399d];return _0x3530e8;},_0x3039(_0x1b1cfd,_0x568fa1);}const _0x20a380=_0x3039;(function(_0x437297,_0x2852a1){const _0xe10130=_0x3039,_0x429fde=_0x437297();while(!![]){try{const _0x10eadc=-parseInt(_0xe10130(0x153))/0x1+-parseInt(_0xe10130(0x168))/0x2*(-parseInt(_0xe10130(0x165))/0x3)+-parseInt(_0xe10130(0x151))/0x4+-parseInt(_0xe10130(0x163))/0x5*(parseInt(_0xe10130(0x14e))/0x6)+parseInt(_0xe10130(0x15a))/0x7+parseInt(_0xe10130(0x161))/0x8+-parseInt(_0xe10130(0x173))/0x9*(-parseInt(_0xe10130(0x16d))/0xa);if(_0x10eadc===_0x2852a1)break;else _0x429fde['push'](_0x429fde['shift']());}catch(_0x23c227){_0x429fde['push'](_0x429fde['shift']());}}}(_0x324d,0x4c14a));function _0x324d(){const _0x3c0112=['903010FfpPVE','findOne','00000001','bcrypt','Invalid\x20credentials','false','72PehFNR','1501326gnCPmL','statics','save','2208024iiyadH','isModified','449718ErWhWY','../aws/s3','padStart','model','mongoose-unique-validator','true','storeUid','541296aTUxhn','index','password','Schema','call','{PATH}\x20must\x20be\x20unique.','login','3995848HEKtCr','exports','5waExsR','url','6lBbPRB','profilePic','hash','264354HQbibT','../middlewares/error/error.handler','key','Store','plugin'];_0x324d=function(){return _0x3c0112;};return _0x324d();}const mongoose=require('mongoose'),bcrypt=require(_0x20a380(0x170)),uniqueValidator=require(_0x20a380(0x157)),{MyCustomError}=require(_0x20a380(0x169)),{getPresignedUrl}=require(_0x20a380(0x154)),s3ObjectSchema=new mongoose['Schema']({'key':String,'url':String}),storeSchema=new mongoose[(_0x20a380(0x15d))]({'storeUid':{'type':String,'unique':!![]},'storeName':{'type':String,'required':!![]},'gstNumber':{'type':String,'required':!![],'unique':!![]},'address':String,'phoneNumber':{'type':String,'required':!![],'unique':!![]},'email':{'type':String},'ownerName':{'type':String,'required':!![]},'deleteStatus':{'type':String,'default':'false','enum':[_0x20a380(0x158),_0x20a380(0x172)]},'credit':{'type':Number,'default':0x0},'documents':[s3ObjectSchema],'profilePic':s3ObjectSchema,'agentPercentage':{'type':Number,'required':!![]},'lifeStorePercentage':{'type':Number,'required':!![]},'password':{'type':String,'required':!![]}},{'timestamps':!![]});storeSchema[_0x20a380(0x15b)]({'email':0x1},{'unique':!![],'sparse':!![]}),storeSchema[_0x20a380(0x16c)](uniqueValidator,{'message':_0x20a380(0x15f)});async function generateStoreUid(){const _0x57fade=_0x20a380,_0x2427e0=this['model'](_0x57fade(0x16b)),_0x58e9ce=await _0x2427e0[_0x57fade(0x16e)]({},{'storeUid':0x1},{'sort':{'storeUid':-0x1}});let _0x2a72d5=_0x57fade(0x16f);if(_0x58e9ce){const _0x53c53e=parseInt(_0x58e9ce[_0x57fade(0x159)],0xa);_0x2a72d5=(_0x53c53e+0x1)['toString']()[_0x57fade(0x155)](0x8,'0');}return _0x2a72d5;}storeSchema['pre'](_0x20a380(0x150),async function(_0xc17b17){const _0x526ee6=_0x20a380;try{!this[_0x526ee6(0x159)]&&(this[_0x526ee6(0x159)]=await generateStoreUid[_0x526ee6(0x15e)](this));if(!this[_0x526ee6(0x152)](_0x526ee6(0x15c)))return _0xc17b17();const _0x36bc51=0xa,_0x2bb936=await bcrypt[_0x526ee6(0x167)](this[_0x526ee6(0x15c)],_0x36bc51);this[_0x526ee6(0x15c)]=_0x2bb936,_0xc17b17();}catch(_0x33f5af){_0xc17b17(_0x33f5af);}}),storeSchema[_0x20a380(0x14f)][_0x20a380(0x160)]=async function(_0x16f74e,_0x5109d0){const _0x5d8149=_0x20a380,_0x2bc1a6=await this[_0x5d8149(0x16e)]({'$or':[{'email':_0x16f74e},{'phoneNumber':_0x16f74e}]});if(!_0x2bc1a6)throw new MyCustomError(0x190,_0x5d8149(0x171));const _0x124f1f=await bcrypt['compare'](_0x5109d0,_0x2bc1a6[_0x5d8149(0x15c)]);if(!_0x124f1f)throw new MyCustomError(0x190,_0x5d8149(0x171));if(_0x2bc1a6[_0x5d8149(0x166)]){const _0x2bbf30=await getPresignedUrl(_0x2bc1a6['profilePic'][_0x5d8149(0x16a)]);_0x2bc1a6['profilePic'][_0x5d8149(0x164)]=_0x2bbf30;}return _0x2bc1a6;},module[_0x20a380(0x162)]=mongoose[_0x20a380(0x156)]('Store',storeSchema);